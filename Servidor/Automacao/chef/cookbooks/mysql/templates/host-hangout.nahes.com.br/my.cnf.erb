#
# Generated by Chef for <%= node['hostname'] %>
#
# Local modifications will be overwritten.
#
# For explanations see
# http://dev.mysql.com/doc/mysql/en/server-system-variables.html
##

# Opções do cliente mysqldump
##

[client]
port            = 3306
socket          = <%= node['mysql']['socket'] %>

# Opções do Servicor principal MySQL
##

[mysqld_safe]
socket          = <%= node['mysql']['socket'] %>
nice            = 0

[mysqld]
log_error       = /data/db/logs/mysqldb/mysqld.log
datadir         = /data/db/mysqldb
socket          = <%= node['mysql']['socket'] %>
pid-file        = <%= node['mysql']['pid_file'] %>
tmpdir          = /data/db/temp
user            = mysql
port            = 3306
basedir         = /usr

# Não estamos utilizando o InnoDB, apenas MyISAM
skip-innodb

# Tiramos um pouco de overhead desnecessario do servidor
skip-external-locking
skip-locking
skip-federated

# Memória utilizada pelo servidor:
# key_buffer + max_connections * (join_buffer + record_buffer + sort_buffer + thread_stack + tmp_table_size)

# Número máximo de conexões simultâneas.
max_connections=4096

# Quantidade em segundos que uma thread tem que ser
# desconectada caso esteja ociosa.
wait_timeout=300

# Tamanho máximo dos pacotes das queries que chegam
# ao servidor. (importante para não gerar erros nas consultas)
max_allowed_packet = 16M

# Logs Binários e Replicação
##

# Expiração de logs binarios
expire_logs_days=8

# Localização do arquivo do log binário
log-bin=/data/db/mysqldb/mysql-bin.log

# Número de identificação do servidor. O banco de dados
# Master é o 1, seguido dos Slaves a partir de 2.
server-id=6

# Desempenho
##

# Quantidade de execução de consultas em threads simultaneamente.
# O processo consome CPU e por isso tem que ser definido
# de acordo com a quantidade de processadores:
# 2x Qtde. de CPUs
thread_concurrency = 32

# Quantidade de threads (conexões ao banco) simultâneas que
# o servidor pode armazenar em cache. Caso haja uso das consultas
# em maior número simultâneo que este, o servidor começa a abrir
# novas threads, gerando um pequeno overhead adicional de memória
# e processamento.
thread_cache_size = 2048

# Número de tabelas que o servidor armazena em cache
# para ser utilizado pelas conexões ao servidor. Tem haver
# com a quantidade de file descriptors o servidor abre no
# sistema de arquivos para ler os dados.
# Média de 25 tabelas (WP) x 30, média de 750.
table_cache = 2048

# Quantidade de memória reservada para os resultados de consultas
# que são feitas frequentemente e por isso não precisam ser
# re-feitas a todo momento.
query_cache_size = 10G

# Quantidade de memoria reservada para armazenar as consultas 
# do MySQL e suas chaves/índices. Recomendado de 1/4 da memória
# para banco dedicada ao servidor até 1/2.
key_buffer = 5G

# Para cada operação de consultas JOIN, tamanho de memória
# reservada de buffer.
join_buffer_size = 512K

# Para cada operação de funções SORT, tamanho de memória
# reservada de buffer.
sort_buffer_size = 512K

# Tamanho do buffer para as leituras das consultas
read_buffer_size = 512K

# Slow Queries
##

# Tamanho em segundos quando uma consulta é considerada lenta
# demais e por isso é registrada em um arquivo para análise e 
# melhoramento do código.
long_query_time = 2

# Arquivo destino ao qual os registros de consultas lentas
# serão escritos.
log-slow-queries = /data/db/logs/mysqldb/mysql-slow.log

# Opções de InnoDB
##

# Configurar os tipos padrões de engines para InnoDB
#default-storage-engine=innodb

# Utilizar arquivos de tablespace por tabela ao invés de todo banco de dados
#innodb_file_per_table

# Set buffer pool size to 50-80% of your computer's memory
#innodb_buffer_pool_size=1024M
#innodb_additional_mem_pool_size=20M

# Set the log file size to about 25% of the buffer pool size
#innodb_log_file_size=124M
#innodb_log_buffer_size=8M

# Quando efetuar um 'flush' no log
#innodb_flush_log_at_trx_commit=1

# Tempo de lock de transações InnoDB
#innodb_lock_wait_timeout=30

[mysqldump]
quick
quote-names
max_allowed_packet      = 16M

[mysql]
#no-auto-rehash # faster start of mysql but no tab completition

[isamchk]
key_buffer              = 16M

!includedir /etc/mysql/conf.d/
