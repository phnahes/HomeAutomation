digraph G {
	graph [layout=dot]
	rankdir=LR;
	label="Automacao Residencial";
	fontsize=32;
	labelloc=t;

//		subgraph clustera {
//			style=filled;
//			fillcolor=white;
//			color=black;

			usuario[label=Usuario, shape=circle, style=filled, fillcolor=red];
			subgraph cluster1 {
				style=filled;
				fontsize=24;
				color=blue;
				fillcolor=white;
				label="Servidor\n Cloud Computing";
				nginx[label="Nginx", shape=box3d, style=filled, fillcolor=blue, fontcolor=white];
				php[label="PHP", shape=box3d, style=filled, fillcolor=purple, fontcolor=white];
				memcached[label="Memcached", shape=box3d, style=filled, fillcolor=tomato];
				mysql[label="Mysql", shape=box3d, style=filled, fillcolor=lightsalmon];

				admin[label="Administracao\n(PHP)", shape=box, style=filled, fillcolor=springgreen];
				pooling[label="Cron\nPooling\n(PHP)",shape=box, style=filled, fillcolor=navy, fontcolor=white];
				{ 
					rank=sink;
					getstatus[label="get_status_page.php"];
					parsestatus[label="parse_status_page.php"];
					setstatus[label="set_status_page.php"];
					callagent[label="call_agent.php"];
				}
			}
			
			subgraph cluster2 {
				style=filled;
				color=tomato;
				fillcolor=white;
				fontsize=24;
				label="Arduino Board";
				arduino[label=Arduino, shape=box3d, style=filled, fillcolor=lightseagreen];
				status[label="/status", style=filled, fillcolor=greenyellow];
				{ 
					rank=sink;
					dev1[label="Device 01", shape=box, style=filled, fillcolor=gold];
					dev2[label="Device 02", shape=box, style=filled, fillcolor=gold];
					dev3[label="Device 03", shape=box, style=filled, fillcolor=gold];
				}
				sensor[label="Sensores", shape=box, style=filled, fillcolor=blue];
				pgdev1[label="Page ON/OFF\nDev1", shape=box, style=filled, fillcolor=greenyellow];
				pgdev2[label="Page ON/OFF\nDev2", shape=box, style=filled, fillcolor=greenyellow];
				pgdev3[label="Page ON/OFF\nDev3", shape=box, style=filled, fillcolor=greenyellow];
			}
			//Arduino
			arduino->{dev1 dev2 dev3 sensor};
			status->arduino;
			

			//Servidor
			usuario->nginx[constraint=true];

			pooling->{ getstatus parsestatus setstatus callagent }[label="Inclui componente:", fontcolor=red, color=red, constraint=true];
			setstatus->memcached[constraint=true];
			callagent->memcached[constraint=true];
			getstatus->status[constraint=true];	

			admin->php[constraint=true];
			php->pooling[constraint=false];
			nginx->php[constraint=false];
			nginx->admin[constraint=true];
			php->mysql[constraint=true];

			callagent->{pgdev1 pgdev2 pgdev3}->arduino;

		}
//}

